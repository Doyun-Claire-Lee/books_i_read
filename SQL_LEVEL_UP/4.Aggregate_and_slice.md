# 집약과 자르기

## 집약
 - COUNT, SUM, AVG, MAX, MIN
 - GROUP BY 구로 집약했을 때, SELECT 구에 입력할 수 있는 것은 아래 세 가지 뿐 
   1. 상수
   2. GROUP BY 구에서 사용한 집약 키
   3. 집약 함수
 - 집약 쿼리의 실행 계획을 살펴 보면, 보통 '해시' 알고리즘을 사용함 (경우에 따라서는 정렬을 사용하기도 함)
 - 정렬과 해시 모두 메모리를 많이 사용하므로, 충분한 워킹 메모리가 확보되지 않으면 스왑이 발생해 저장소 위의 파일이 사용되며 굉장히 느려짐.
 - 이 때 메모리 영역의 크기가 집약 대상 데이터 양에 비해 부족하면 일시 영역(저장소)를 사용해 부족한 만큼 채우게 됨 -> TEMP 탈락!
 - TEMP 탈락이 발생하면 메모리만으로 처리가 끝나는 경우와 비교해 극단적으로 성능이 떨어지게 됨.
 - 따라서 집약 함수를 사용하는 쿼리에서는 충분한 성능 검증이 이루어져야 함.
 - 최악의 경우 TEMP 영역도 모두 써버려 SQL 구문이 비정상 종료되는 경우가 발생할 수도 있음.

## 자르기
 - GROUP BY는 자르기와 집약을 한꺼번에 수행하는 연산
 - GROUP BY로 잘라 만든 부분 집합들을 수학적으로는 '파티션'이라고 함.
 - 파티션: 서로 중복되는 요소를 가지지 않는 부분 집합
 - GROUP BY에서 집약 기능을 제외하고 자르는 기능만 남긴 것 : PARTITION BY 구
 - GROUP BY 구는 입력 집합을 집약하므로 전혀 다른 레벨의 출력으로 변환하지만, PARTITION BY 구는 입력에 정보를 추가할 뿐이므로 원본 테이블 정보를 그대로 유지함.