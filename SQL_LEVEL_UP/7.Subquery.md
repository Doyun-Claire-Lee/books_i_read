# 서브쿼리

### 서브쿼리가 일으키는 폐해
1. 서브쿼리의 문제점
   - 서브쿼리가 실체적인 데이터를 저장하고 있지 않다는 점에 의해 성능적 문제 발생함
     - 연산 비용 추가 및 실행 계획 변동 리스크 발생
     - 데이터 io 비용 발생: 대부분 메모리에 결과를 확보하므로 오버헤드 발생
     - 최적화 불가: 인덱스 또는 제약 정보를 가지지 않음
   - 서브쿼리는 유연성으로 인해 코딩을 할 시에는 편리하지만, 결과값을 과연 서브쿼리를 사용해야만 얻을 수 있는 것인지 항상 고민해야 함.
2. 서브쿼리 의존증
   - 상관 서브쿼리는 답이 될 수 없다. 
   - 윈도우 함수로 결합을 제거
3. 장기적 관점에서의 리스크 관리
   - 결합을 사용한 쿼리는 불안정 요소가 있음
     - 결합 알고리즘의 변동 리스크
     - 환경 요인에 의한 지연 리스크(인덱스, 메모리, 매개변수 등)
     - => 결합을 사용한다는 것은 장기적 관점에서 고려해야 할 리스크를 늘리게 된다는 것
   - 상관 서브쿼리를 사용해도 결합을 사용한 쿼리와 실행 계획이 비슷하게 나옴
   - 실행 계획이 단순할수록 성능이 안정적이다.
   - 엔지니어는 기능(결과)뿐만 아니라 비기능적인 부분(성능)도 보장할 책임이 있다.
4. 서브쿼리는 정말 나쁠까?
   - 서브쿼리 자체가 나쁜것은 아님
   - 각 부분을 조합해서 최종적인 결과 집합을 만들어내는 바텀업 타입의 사고방식과 굉장히 좋은 상성을 가지고 있음
   - 그러나 비절차 지향형 언어인 SQL과 바텀업 사고방식은 지향하는 방향과 성질이 다르기에 효율적인 코드가 되기에는 어려움

### 서브쿼리 사용이 더 나은 경우
1. 결합과 집약 순서
   - 사전에 결합 레코드 수를 압축해야 할 경우(from 절에 서브쿼리를 사용하여 집약)
   - 데이터가 많을 수록 그 차이는 극명하게 드러남.
